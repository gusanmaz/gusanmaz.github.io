<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game of Life - Ä°nteraktif EÄŸitim</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>

    <style>
        :root {
            --bg-dark: #1a1b1e;
            --bg-panel: #25262b;
            --accent: #ff007a; /* Patt Vira'nÄ±n tarzÄ±na uygun canlÄ± bir pembe */
            --accent-sec: #00e5ff;
            --text-main: #e1e1e6;
            --text-muted: #a0a0a5;
        }

        body {
            font-family: 'Segoe UI', 'Inter', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* HEADER */
        header {
            background-color: #141517;
            padding: 0 25px;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--accent);
        }
        h1 { font-size: 1.4rem; margin: 0; display: flex; align-items: center; gap: 15px; color: #fff; }
        .subtitle { font-size: 0.9rem; color: var(--text-muted); font-weight: normal; }
        .step-badge {
            background: linear-gradient(45deg, var(--accent), #bd0059);
            color: #fff; padding: 6px 14px;
            border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 0, 122, 0.3);
        }

        /* LAYOUT */
        .main-layout {
            display: flex;
            flex: 1;
            height: calc(100vh - 60px);
        }

        /* SOL PANEL: DERS */
        .tutorial-panel {
            width: 33%;
            padding: 30px;
            overflow-y: auto;
            background-color: var(--bg-panel);
            border-right: 1px solid #333;
            line-height: 1.7;
            font-size: 1.05rem;
        }
        
        /* TIPOGRAFÄ° VE KUTULAR */
        h2 { color: var(--accent-sec); margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
        h3 { color: #fff; margin-top: 25px; margin-bottom: 10px; font-size: 1.1rem; }
        p { margin-bottom: 15px; color: #ccc; }
        
        .patt-box {
            background: linear-gradient(to right, rgba(255, 0, 122, 0.1), transparent);
            border-left: 4px solid var(--accent);
            padding: 15px 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }
        .patt-box strong { color: var(--accent); display: block; margin-bottom: 5px; }
        
        .concept-box {
            background: rgba(0, 229, 255, 0.05);
            border: 1px solid rgba(0, 229, 255, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
        }
        .concept-title { color: var(--accent-sec); font-weight: bold; display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        
        code { background: #141517; padding: 2px 6px; border-radius: 4px; color: #ff79c6; font-family: 'Fira Code', monospace; font-size: 0.9em; }

        /* ORTA PANEL: EDÄ°TÃ–R */
        .editor-panel {
            width: 34%;
            display: flex;
            flex-direction: column;
            background-color: #282a36; /* Dracula bg */
            border-right: 1px solid #333;
        }
        .editor-toolbar {
            background-color: #191a21;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        .run-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
            display: flex; align-items: center; gap: 6px;
        }
        .run-btn:hover { background: #ff3399; transform: scale(1.05); }

        .CodeMirror { flex: 1; height: auto !important; font-family: 'Fira Code', monospace; font-size: 14px; }

        /* SAÄ PANEL: Ã–NÄ°ZLEME */
        .preview-panel {
            width: 33%;
            background-color: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        #canvas-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        #p5-container {
            border: 2px solid #333;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            border-radius: 4px;
            overflow: hidden;
            /* Canvas buraya gelecek */
        }

        /* Butonlar iÃ§in Ã¶zel stil - Patt Vira stili */
        .p5-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        .p5-controls button {
            background-color: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .p5-controls button:hover {
            background-color: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* NAVÄ°GASYON */
        .nav-area {
            margin-top: 40px;
            display: flex;
            gap: 15px;
            padding-bottom: 20px;
        }
        .nav-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            background-color: #333;
            color: white;
            transition: 0.2s;
        }
        .nav-btn.next { background: linear-gradient(45deg, #2196F3, #00bcd4); }
        .nav-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        #error-log { 
            color: #ff5252; 
            background: rgba(255,82,82,0.1); 
            border: 1px solid rgba(255,82,82,0.3);
            padding: 15px; 
            font-family: monospace; 
            display: none; 
            width: 90%; 
            margin-top: 20px; 
            border-radius: 8px; 
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§¬ Game of Life <span class="subtitle">| P5.js AtÃ¶lyesi</span></h1>
    <div class="step-badge">AdÄ±m <span id="current-step">1</span> / 9</div>
</header>

<div class="main-layout">
    <div class="tutorial-panel" id="tutorial-content">
        <!-- Ä°Ã§erik JS ile dolacak -->
    </div>

    <div class="editor-panel">
        <div class="editor-toolbar">
            <span style="font-size: 0.85rem; color: #aaa;">sketch.js</span>
            <button class="run-btn" onclick="runCode()">â–¶ Ã‡alÄ±ÅŸtÄ±r</button>
        </div>
        <textarea id="code-area"></textarea>
    </div>

    <div class="preview-panel">
        <div id="canvas-wrapper">
            <div id="p5-container"></div>
            <!-- Kontrol butonlarÄ± buraya eklenecek (JS ile) -->
            <div id="p5-controls" class="p5-controls"></div>
        </div>
        <div id="error-log"></div>
    </div>
</div>

<script>
    /*
     * MÃœFREDAT VE Ä°Ã‡ERÄ°K
     * Patt Vira'nÄ±n videosuna sadÄ±k kalÄ±narak hazÄ±rlanmÄ±ÅŸtÄ±r.
     */
    const steps = [
        {
            title: "1. GiriÅŸ: IzgarayÄ± OluÅŸturmak",
            content: `
                <h2>BoÅŸluktan DÃ¼zene</h2>
                <p>BaÅŸlamadan Ã¶nce Patt Vira'nÄ±n videosunu izlemeniz gerekmektedir. Bu atÃ¶lye ilgili video baz alÄ±narak hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
                
                <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; margin-bottom: 20px;">
                    <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://www.youtube.com/embed/lsWulRIWzdo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                </div>

                <p>Patt Vira videoya <strong>"Game of Life"</strong>Ä±n kurallarÄ±ndan deÄŸil, Ã¶nce oyun alanÄ±mÄ±zÄ± inÅŸa etmekten baÅŸlÄ±yor. Ã‡Ã¼nkÃ¼ dijital bir dÃ¼nyada, hÃ¼crelerin yaÅŸayacaÄŸÄ± bir eve ihtiyacÄ±mÄ±z var.</p>
                
                <div class="patt-box">
                    <strong>ğŸ¥ Patt Vira Diyor ki:</strong>
                    "Ä°lk yapmamÄ±z gereken ÅŸey ekranÄ± kÃ¼Ã§Ã¼k karelere bÃ¶lmek. Bunu matematiksel bir bulmaca gibi dÃ¼ÅŸÃ¼nÃ¼n. Ekran geniÅŸliÄŸini (width) kare boyutuna (size) bÃ¶lersek, kaÃ§ sÃ¼tunumuz olacaÄŸÄ±nÄ± buluruz."
                </div>

                <div class="concept-box">
                    <div class="concept-title">ğŸ“˜ Temel Kavram: DÃ¶ngÃ¼ler (Loops)</div>
                    <p>Bilgisayara "Bana 100 tane kare Ã§iz" demek yerine, "Åu iÅŸlemi 100 kere tekrar et" deriz. Buna <strong>Loop</strong> denir.</p>
                    <ul>
                        <li><code>i</code> dÃ¶ngÃ¼sÃ¼ soldan saÄŸa (SÃ¼tunlar) ilerler.</li>
                        <li><code>j</code> dÃ¶ngÃ¼sÃ¼ yukarÄ±dan aÅŸaÄŸÄ± (SatÄ±rlar) iner.</li>
                    </ul>
                    <p>Bu <strong>Ä°Ã§ Ä°Ã§e DÃ¶ngÃ¼ (Nested Loop)</strong> yapÄ±sÄ±, bir apartmandaki tÃ¼m daireleri tek tek gezmek gibidir.</p>
                </div>

                <p>SaÄŸdaki kodda <code>rect()</code> fonksiyonu ile kareleri Ã§iziyoruz. <strong>"Ã‡alÄ±ÅŸtÄ±r"</strong>a basÄ±p Ä±zgarayÄ± gÃ¶rÃ¼n!</p>
            `,
            code: `let size = 40; // Karelerin bÃ¼yÃ¼klÃ¼ÄŸÃ¼
let cols; 
let rows;

function setup() {
  createCanvas(400, 400);
  
  // KaÃ§ sÃ¼tun ve satÄ±r sÄ±ÄŸacaÄŸÄ±nÄ± hesapla
  cols = width / size;
  rows = height / size;
}

function draw() {
  background(220);
  
  // Ä°Ã‡ Ä°Ã‡E DÃ–NGÃœLER
  // i: SÃ¼tun numarasÄ± (0, 1, 2...)
  for (let i = 0; i < cols; i++) {
  
    // j: SatÄ±r numarasÄ±
    for (let j = 0; j < rows; j++) {
      
      // Karenin x ve y koordinatlarÄ±nÄ± hesapla
      let x = i * size;
      let y = j * size;
      
      stroke(0); // Siyah kenarlÄ±k
      fill(255); // Beyaz iÃ§
      rect(x, y, size, size);
    }
  }
}`
        },
        {
            title: "2. Veri YapÄ±sÄ±: 2D Diziler",
            content: `
                <h2>GÃ¶rÃ¼nenin ArkasÄ±ndaki Veri</h2>
                <p>Ekrana kare Ã§izdik ama bilgisayar ÅŸu an sadece resim Ã§izdiÄŸini sanÄ±yor. Hangi karenin "canlÄ±" hangisinin "Ã¶lÃ¼" olduÄŸunu aklÄ±nda tutmuyor.</p>
                
                <div class="patt-box">
                    <strong>ğŸ¥ Patt Vira Diyor ki:</strong>
                    "GÃ¶rsellik gÃ¼zel ama bize bir beyin lazÄ±m! Her bir karenin durumunu (1 veya 0) saklamak iÃ§in 2 Boyutlu Dizi (2D Array) oluÅŸturacaÄŸÄ±z."
                </div>

                <div class="concept-box">
                    <div class="concept-title">ğŸ§  Temel Kavram: Diziler (Arrays)</div>
                    <p>DeÄŸiÅŸken (Variable) tek bir bilgi tutar (<code>x = 5</code>). Dizi (Array) ise bir listedir (<code>liste = [5, 10, 15]</code>).</p>
                    <p><strong>2D Dizi</strong> ise "Listelerin Listesi"dir. Bir Excel tablosu gibi dÃ¼ÅŸÃ¼nÃ¼n:</p>
                    <pre>grid = [
  [0, 1, 0],  // 1. SÃ¼tun
  [1, 1, 0],  // 2. SÃ¼tun
  ...
]</pre>
                    <p><code>grid[i][j]</code> bize tam olarak i. sÃ¼tun ve j. satÄ±rdaki bilgiyi verir.</p>
                </div>

                <p>Kodu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda siyah (1) ve beyaz (0) kareler rastgele daÄŸÄ±lacak. Ã‡Ã¼nkÃ¼ <code>random(2)</code> ile yazÄ± tura attÄ±k!</p>
            `,
            code: `let size = 40;
let cols, rows;
let grid = []; // Veriyi tutacak boÅŸ liste

function setup() {
  createCanvas(400, 400);
  cols = width / size;
  rows = height / size;

  // 2D DÄ°ZÄ°YÄ° OLUÅTURMA
  for (let i = 0; i < cols; i++) {
    grid[i] = []; // Her sÃ¼tun iÃ§in yeni bir liste aÃ§
    
    for (let j = 0; j < rows; j++) {
      // floor(random(2)) bize 0 veya 1 verir
      grid[i][j] = floor(random(2)); 
    }
  }
}

function draw() {
  background(220);

  for (let i = 0; i < cols; i++) {
    for (let j = 0; j < rows; j++) {
      let x = i * size;
      let y = j * size;
      
      // VERÄ°YE GÃ–RE RENKLENDÄ°RME
      // EÄŸer grid[i][j] 1 ise SÄ°YAH, deÄŸilse BEYAZ
      if (grid[i][j] == 1) {
        fill(0); 
      } else {
        fill(255);
      }
      
      rect(x, y, size, size);
    }
  }
}`
        },
        {
            title: "3. DÃ¼zenleme: Class KullanÄ±mÄ±",
            content: `
                <h2>DaÄŸÄ±nÄ±klÄ±ÄŸÄ± Toplamak: Class</h2>
                <p>Kodumuz ÅŸimdiden uzadÄ±. Patt Vira burada profesyonel bir dokunuÅŸ yapÄ±yor: <strong>Refactoring</strong> (Kodu Ä°yileÅŸtirme).</p>
                
                <div class="patt-box">
                    <strong>ğŸ¥ Patt Vira'nÄ±n YÃ¶ntemi:</strong>
                    "TÃ¼m bu grid iÅŸlemlerini ana kodun iÃ§inde (setup/draw) tutmak yerine, onlarÄ± kendi Ã¶zel 'Kutusuna' (Class) taÅŸÄ±yalÄ±m. BÃ¶ylece ana kodumuz tertemiz kalacak."
                </div>

                <div class="concept-box">
                    <div class="concept-title">ğŸ—ï¸ Temel Kavram: Class (SÄ±nÄ±f)</div>
                    <p>Bir <strong>Class</strong>, nesneler Ã¼retmek iÃ§in bir fabrikadÄ±r. Bizim <code>Grid</code> fabrikamÄ±z ÅŸunlarÄ± bilir:</p>
                    <ul>
                        <li><strong>constructor:</strong> Fabrika ilk aÃ§Ä±ldÄ±ÄŸÄ±nda ne yapacak? (Diziyi oluÅŸtur)</li>
                        <li><strong>display:</strong> Kendini nasÄ±l Ã§izecek? (Kareleri boya)</li>
                    </ul>
                    <p>BÃ¶ylece <code>setup()</code> iÃ§inde sadece <code>myGrid = new Grid()</code> dememiz yeterli olur.</p>
                </div>
                
                <p>Bu adÄ±mda gÃ¶rsel bir deÄŸiÅŸiklik yok, ama kodun "Mimarisi" Ã§ok daha saÄŸlam hale geldi.</p>
            `,
            code: `let size = 40;
let myGrid; // Grid nesnemiz iÃ§in deÄŸiÅŸken

function setup() {
  createCanvas(400, 400);
  // Grid fabrikasÄ±ndan yeni bir Ä±zgara Ã¼ret
  myGrid = new Grid(size);
}

function draw() {
  background(220);
  // Grid kendi kendini Ã§izsin
  myGrid.display();
}

// --- GRID SINIFI (CLASS) ---
class Grid {
  // Kurucu Fonksiyon: Ä°lk deÄŸerleri ayarlar
  constructor(cellSize) {
    this.size = cellSize;
    this.cols = width / this.size;
    this.rows = height / this.size;
    this.grid = [];
    
    // BaÅŸlangÄ±Ã§ta rastgele doldur
    for (let i = 0; i < this.cols; i++) {
      this.grid[i] = [];
      for (let j = 0; j < this.rows; j++) {
        this.grid[i][j] = floor(random(2));
      }
    }
  }
  
  // Ã‡izim Fonksiyonu
  display() {
    for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        let x = i * this.size;
        let y = j * this.size;
        
        if (this.grid[i][j] == 1) {
          fill(0);
        } else {
          fill(255);
        }
        rect(x, y, this.size, this.size);
      }
    }
  }
}`
        },
        {
            title: "4. MantÄ±k: KomÅŸularÄ±nÄ± Say",
            content: `
                <h2>HayatÄ±n KuralÄ±: KomÅŸuluk</h2>
                <p>Game of Life'da bir hÃ¼crenin kaderini (yaÅŸayÄ±p Ã¶leceÄŸini) komÅŸularÄ± belirler. Her hÃ¼crenin etrafÄ±nda 8 komÅŸusu vardÄ±r.</p>

                <div class="patt-box">
                    <strong>ğŸ¥ Patt Vira AÃ§Ä±klÄ±yor:</strong>
                    "Bir hÃ¼crenin etrafÄ±ndaki 3x3'lÃ¼k alanÄ± taramalÄ±yÄ±z. Bunu yapmak iÃ§in yine iÃ§ iÃ§e dÃ¶ngÃ¼ kullanacaÄŸÄ±z ama bu sefer <code>-1</code>'den <code>+1</code>'e kadar. Yani solundan saÄŸÄ±na, yukarÄ±sÄ±ndan aÅŸaÄŸÄ±sÄ±na bakacaÄŸÄ±z."
                </div>

                <p>AÅŸaÄŸÄ±daki kodda hÃ¼crelerin iÃ§ine kÄ±rmÄ±zÄ± sayÄ±lar yazdÄ±k. Bu sayÄ±lar, o hÃ¼crenin <strong>canlÄ± komÅŸu sayÄ±sÄ±nÄ±</strong> gÃ¶steriyor. </p>
                <p><em>Not: Kenardaki hÃ¼creler iÃ§in ÅŸimdilik basit bir Ã§Ã¶zÃ¼m uyguladÄ±k, yoksa hata verirlerdi.</em></p>
            `,
            code: `let size = 50; // YazÄ±larÄ± okumak iÃ§in bÃ¼yÃ¼ttÃ¼k
let myGrid;

function setup() {
  createCanvas(400, 400);
  myGrid = new Grid(size);
  noLoop(); // Tek kare Ã§izip dursun, rahat inceleyelim
}

function draw() {
  background(220);
  myGrid.display();
}

class Grid {
  constructor(cellSize) {
    this.size = cellSize;
    this.cols = width / this.size;
    this.rows = height / this.size;
    this.grid = [];
    
    for (let i = 0; i < this.cols; i++) {
      this.grid[i] = [];
      for (let j = 0; j < this.rows; j++) {
        this.grid[i][j] = floor(random(2));
      }
    }
  }

  display() {
    for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        // Kareyi Ã§iz
        if (this.grid[i][j] == 1) fill(0);
        else fill(255);
        rect(i*this.size, j*this.size, this.size, this.size);
        
        // KOMÅU SAYISINI HESAPLA VE YAZ
        // Kenarlardan kaÃ§Ä±nÄ±yoruz (Hata almamak iÃ§in)
        if (i > 0 && i < this.cols-1 && j > 0 && j < this.rows-1) {
            let neighbors = this.countNeighbors(i, j);
            
            fill(255, 0, 0); // KÄ±rmÄ±zÄ± yazÄ±
            textSize(20);
            textAlign(CENTER, CENTER);
            text(neighbors, i*this.size + this.size/2, j*this.size + this.size/2);
        }
      }
    }
  }
  
  // --- KRÄ°TÄ°K FONKSÄ°YON ---
  countNeighbors(x, y) {
    let sum = 0;
    // 3x3 alan taramasÄ± (x-1, x, x+1)
    for (let i = -1; i < 2; i++) {
      for (let j = -1; j < 2; j++) {
        sum += this.grid[x+i][y+j];
      }
    }
    // Kendimizi toplama dahil ettik, onu Ã§Ä±karalÄ±m!
    sum -= this.grid[x][y];
    return sum;
  }
}`
        },
        {
            title: "5. SÄ±nÄ±rlarÄ± AÅŸmak: Modulo (%)",
            content: `
                <h2>Pac-Man Evreni</h2>
                <p>Az Ã¶nceki kodda kenarlar sorunluydu. Patt Vira burada harika bir matematiksel hile kullanÄ±yor: <strong>Modulo OperatÃ¶rÃ¼</strong>.</p>
                
                <div class="patt-box">
                    <strong>ğŸ¥ Video Notu (14:20):</strong>
                    "DÃ¼nyamÄ±zÄ±n dÃ¼z bir tepsi gibi bitmesini istemiyoruz. SaÄŸdan Ã§Ä±kan soldan girsin, yukarÄ±dan Ã§Ä±kan aÅŸaÄŸÄ±dan girsin. Bunu <code>%</code> (Mod) iÅŸareti ile saÄŸlarÄ±z."
                </div>

                <div class="concept-box">
                    <div class="concept-title">ğŸ”¢ Matematik: Modulo (%)</div>
                    <p>BÃ¶lme iÅŸleminden kalanÄ± verir. Saat gibi dÃ¼ÅŸÃ¼nÃ¼n: 13:00 aslÄ±nda 1:00'dir (13 % 12 = 1).</p>
                    <p>FormÃ¼l: <code>(x + i + cols) % cols</code></p>
                    <p>Bu formÃ¼l sayesinde, index -1 olduÄŸunda (sol kenardan Ã§Ä±kÄ±nca), otomatik olarak en saÄŸa (cols-1) Ä±ÅŸÄ±nlanÄ±rÄ±z.</p>
                </div>
            `,
            code: `let size = 40;
let myGrid;

function setup() {
  createCanvas(400, 400);
  myGrid = new Grid(size);
  noLoop();
}

function draw() {
  background(220);
  myGrid.display();
}

class Grid {
  constructor(cellSize) {
    this.size = cellSize;
    this.cols = width / this.size;
    this.rows = height / this.size;
    this.grid = [];
    
    for (let i = 0; i < this.cols; i++) {
      this.grid[i] = [];
      for (let j = 0; j < this.rows; j++) {
        this.grid[i][j] = floor(random(2));
      }
    }
  }

  display() {
    for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        if (this.grid[i][j] == 1) fill(0);
        else fill(255);
        rect(i*this.size, j*this.size, this.size, this.size);
        
        // ArtÄ±k kenar kontrolÃ¼ne gerek yok!
        let neighbors = this.countNeighbors(i, j);
        fill(255, 0, 0);
        textSize(20);
        textAlign(CENTER, CENTER);
        text(neighbors, i*this.size + this.size/2, j*this.size + this.size/2);
      }
    }
  }
  
  countNeighbors(x, y) {
    let sum = 0;
    for (let i = -1; i < 2; i++) {
      for (let j = -1; j < 2; j++) {
        
        // SÄ°HÄ°RLÄ° FORMÃœL: KenarlarÄ± birbirine baÄŸlar
        let col = (x + i + this.cols) % this.cols;
        let row = (y + j + this.rows) % this.rows;
        
        sum += this.grid[col][row];
      }
    }
    sum -= this.grid[x][y];
    return sum;
  }
}`
        },
        {
            title: "6. Kurallar ve Gelecek Nesil",
            content: `
                <h2>YaÅŸat ya da Ã–ldÃ¼r</h2>
                <p>ArtÄ±k komÅŸularÄ± sayabiliyoruz. Åimdi Conway'in 4 efsanevi kuralÄ±nÄ± uygulama vakti.</p>
                <ol>
                    <li><strong>YalnÄ±zlÄ±k:</strong> KomÅŸu < 2 ise Ã–LÃœR.</li>
                    <li><strong>KalabalÄ±k:</strong> KomÅŸu > 3 ise Ã–LÃœR.</li>
                    <li><strong>Ä°deal:</strong> KomÅŸu 2 veya 3 ise YAÅAR.</li>
                    <li><strong>DoÄŸum:</strong> Ã–lÃ¼ hÃ¼crenin tam 3 komÅŸusu varsa CANLANIR.</li>
                </ol>

                <div class="concept-box">
                    <div class="concept-title">âš ï¸ Kritik Hata: DeÄŸiÅŸikliÄŸi AnÄ±nda Yapmak</div>
                    <p>EÄŸer <code>grid</code> Ã¼zerinde deÄŸiÅŸiklik yaparken hesaplamaya devam edersek, sonuÃ§lar karÄ±ÅŸÄ±r. Bu yÃ¼zden <strong>nextGen</strong> adÄ±nda BOÅ bir sayfa aÃ§arÄ±z, hesaplamalarÄ± oraya yazarÄ±z. Ä°ÅŸimiz bitince eski sayfayÄ± atÄ±p yenisini alÄ±rÄ±z.</p>
                </div>
                
                <p>Ã‡alÄ±ÅŸtÄ±r'a bastÄ±ÄŸÄ±nÄ±zda hareket baÅŸlayacak! HÃ¼crelerin doÄŸup Ã¶ldÃ¼ÄŸÃ¼nÃ¼ izleyin.</p>
            `,
            code: `let size = 10; // KÃ¼Ã§Ã¼k kareler daha iyi gÃ¶rÃ¼nÃ¼r
let myGrid;

function setup() {
  createCanvas(400, 400);
  myGrid = new Grid(size);
  frameRate(10); // HÄ±zÄ± biraz dÃ¼ÅŸÃ¼relim
}

function draw() {
  background(220);
  myGrid.update();  // Hesapla
  myGrid.display(); // Ã‡iz
}

class Grid {
  constructor(cellSize) {
    this.size = cellSize;
    this.cols = width / this.size;
    this.rows = height / this.size;
    this.grid = [];
    
    for (let i = 0; i < this.cols; i++) {
      this.grid[i] = [];
      for (let j = 0; j < this.rows; j++) {
        this.grid[i][j] = floor(random(2));
      }
    }
  }

  display() {
    for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        if (this.grid[i][j] == 1) fill(0);
        else fill(255);
        noStroke(); // KenarlÄ±klarÄ± kaldÄ±rdÄ±k, daha temiz
        rect(i*this.size, j*this.size, this.size, this.size);
      }
    }
  }
  
  update() {
    let nextGen = []; // GELECEK NESÄ°L (BoÅŸ Sayfa)
    
    for (let i = 0; i < this.cols; i++) {
      nextGen[i] = [];
      for (let j = 0; j < this.rows; j++) {
        
        let n = this.countNeighbors(i, j);
        let state = this.grid[i][j];
        
        // KURALLAR
        if (state == 1 && (n < 2 || n > 3)) {
          nextGen[i][j] = 0; // Ã–lÃ¼m
        } else if (state == 0 && n == 3) {
          nextGen[i][j] = 1; // DoÄŸum
        } else {
          nextGen[i][j] = state; // DeÄŸiÅŸim Yok
        }
      }
    }
    
    this.grid = nextGen; // SayfayÄ± Ã§evir
  }
  
  countNeighbors(x, y) {
    let sum = 0;
    for (let i = -1; i < 2; i++) {
      for (let j = -1; j < 2; j++) {
        let col = (x + i + this.cols) % this.cols;
        let row = (y + j + this.rows) % this.rows;
        sum += this.grid[col][row];
      }
    }
    sum -= this.grid[x][y];
    return sum;
  }
}`
        },
        {
            title: "7. EtkileÅŸim: Butonlar",
            content: `
                <h2>Kontrol Paneli</h2>
                <p>Oyun sÃ¼rekli akÄ±yor ama bazen durdurup incelemek veya baÅŸtan baÅŸlatmak isteriz.</p>
                
                <div class="patt-box">
                    <strong>ğŸ¥ Video Notu:</strong>
                    Patt Vira videoda p5.js'in <code>createButton()</code> Ã¶zelliÄŸini kullanarak arayÃ¼z elemanlarÄ± ekliyor. Biz de "Oynat/Durdur", "Temizle" ve "Rastgele" butonlarÄ± ekleyelim.
                </div>
                
                <p>AÅŸaÄŸÄ±daki butonlara basarak simÃ¼lasyonu kontrol edebilirsiniz.</p>
            `,
            code: `let size = 10;
let myGrid;
let isPlaying = false; // BaÅŸlangÄ±Ã§ta duraklat
let btnPlay, btnClear, btnRandom;

function setup() {
  createCanvas(400, 400);
  myGrid = new Grid(size);
  
  // BUTONLARI OLUÅTURMA
  btnPlay = createButton('Oynat/Durdur');
  btnPlay.mousePressed(togglePlay);
  
  btnClear = createButton('Temizle');
  btnClear.mousePressed(resetGrid);
  
  btnRandom = createButton('Rastgele');
  btnRandom.mousePressed(randomGrid);
}

function draw() {
  background(220);
  if (isPlaying) {
    myGrid.update();
  }
  myGrid.display();
}

function togglePlay() {
  isPlaying = !isPlaying;
}
function resetGrid() {
  myGrid.clear();
}
function randomGrid() {
  myGrid.randomize();
}

class Grid {
  constructor(cellSize) {
    this.size = cellSize;
    this.cols = width / this.size;
    this.rows = height / this.size;
    this.grid = [];
    this.randomize();
  }

  randomize() {
    for (let i = 0; i < this.cols; i++) {
      this.grid[i] = [];
      for (let j = 0; j < this.rows; j++) {
        this.grid[i][j] = floor(random(2));
      }
    }
  }
  
  clear() {
     for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        this.grid[i][j] = 0;
      }
    }
  }

  display() {
    for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        if (this.grid[i][j] == 1) fill(0);
        else fill(255);
        noStroke();
        rect(i * this.size, j * this.size, this.size, this.size);
      }
    }
  }
  
  update() {
    let nextGen = [];
    for (let i = 0; i < this.cols; i++) {
      nextGen[i] = [];
      for (let j = 0; j < this.rows; j++) {
        let n = this.countNeighbors(i, j);
        let state = this.grid[i][j];
        if (state == 1 && (n < 2 || n > 3)) nextGen[i][j] = 0;
        else if (state == 0 && n == 3) nextGen[i][j] = 1;
        else nextGen[i][j] = state;
      }
    }
    this.grid = nextGen;
  }
  
  countNeighbors(x, y) {
    let sum = 0;
    for (let i = -1; i < 2; i++) {
      for (let j = -1; j < 2; j++) {
        let col = (x + i + this.cols) % this.cols;
        let row = (y + j + this.rows) % this.rows;
        sum += this.grid[col][row];
      }
    }
    sum -= this.grid[x][y];
    return sum;
  }
}`
        },
        {
            title: "8. TanrÄ± Modu: Mouse EtkileÅŸimi",
            content: `
                <h2>Hayat Yaratmak</h2>
                <p>Åu an sadece izleyiciyiz. Videonun 27. dakikasÄ±nda Patt Vira, mouse ile ekrana dokunarak hÃ¼cre yaratma Ã¶zelliÄŸi ekliyor.</p>
                
                <div class="concept-box">
                    <div class="concept-title">ğŸ–±ï¸ Mouse KoordinatlarÄ±</div>
                    <p><code>mouseX</code> ve <code>mouseY</code> bize piksel deÄŸerini verir (Ã–rn: 250px). Ama bize <strong>Ä±zgara koordinatÄ±</strong> lazÄ±m (Ã–rn: 12. SÃ¼tun).</p>
                    <p>Ã‡Ã¶zÃ¼m: <code>floor(mouseX / size)</code>. 250 / 20 = 12.5 -> 12. SÃ¼tun.</p>
                </div>

                <p><strong>Deneyin:</strong> "Temizle"ye basÄ±n, "Oynat" DURMUÅ olsun. Ekrana kendi desenlerinizi Ã§izin (PlanÃ¶rler, kutular...) ve sonra "Oynat"a basÄ±n!</p>
            `,
            code: `let size = 10;
let myGrid;
let isPlaying = false;
let btnPlay, btnClear, btnRandom;

function setup() {
  createCanvas(400, 400);
  myGrid = new Grid(size);
  
  btnPlay = createButton('Oynat/Durdur');
  btnPlay.mousePressed(togglePlay);
  
  btnClear = createButton('Temizle');
  btnClear.mousePressed(resetGrid);
  
  btnRandom = createButton('Rastgele');
  btnRandom.mousePressed(randomGrid);
}

function draw() {
  background(220);
  if (isPlaying) {
    myGrid.update();
  }
  myGrid.display();
}

// MOUSE SÃœRÃœKLEME
function mouseDragged() {
  // Hangi kutunun Ã¼zerindeyiz?
  let col = floor(mouseX / size);
  let row = floor(mouseY / size);
  
  // Biraz daha kalÄ±n bir fÄ±rÃ§a yapalÄ±m (3x3)
  let margin = 1;
  for(let i = -margin; i <= margin; i++) {
     for(let j = -margin; j <= margin; j++) {
        // SÄ±nÄ±rlarÄ± ve Modulo'yu unutma
        let c = (col + i + myGrid.cols) % myGrid.cols;
        let r = (row + j + myGrid.rows) % myGrid.rows;
        myGrid.grid[c][r] = 1;
     }
  }
}

function togglePlay() { isPlaying = !isPlaying; }
function resetGrid() { myGrid.clear(); }
function randomGrid() { myGrid.randomize(); }

class Grid {
  constructor(cellSize) {
    this.size = cellSize;
    this.cols = width / this.size;
    this.rows = height / this.size;
    this.grid = [];
    this.randomize();
  }
  randomize() {
    for (let i = 0; i < this.cols; i++) {
      this.grid[i] = [];
      for (let j = 0; j < this.rows; j++) { this.grid[i][j] = floor(random(2)); }
    }
  }
  clear() {
     for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) { this.grid[i][j] = 0; }
    }
  }
  display() {
    for (let i = 0; i < this.cols; i++) {
      for (let j = 0; j < this.rows; j++) {
        if (this.grid[i][j] == 1) fill(0); else fill(255);
        noStroke();
        rect(i * this.size, j * this.size, this.size, this.size);
      }
    }
  }
  update() {
    let nextGen = [];
    for (let i = 0; i < this.cols; i++) {
      nextGen[i] = [];
      for (let j = 0; j < this.rows; j++) {
        let n = this.countNeighbors(i, j);
        let state = this.grid[i][j];
        if (state == 1 && (n < 2 || n > 3)) nextGen[i][j] = 0;
        else if (state == 0 && n == 3) nextGen[i][j] = 1;
        else nextGen[i][j] = state;
      }
    }
    this.grid = nextGen;
  }
  countNeighbors(x, y) {
    let sum = 0;
    for (let i = -1; i < 2; i++) {
      for (let j = -1; j < 2; j++) {
        let col = (x + i + this.cols) % this.cols;
        let row = (y + j + this.rows) % this.rows;
        sum += this.grid[col][row];
      }
    }
    sum -= this.grid[x][y];
    return sum;
  }
}`
        },
        {
            title: "9. Final: Renkler ve HSB",
            content: `
                <h2>GÃ¶kkuÅŸaÄŸÄ± Finali ğŸŒˆ</h2>
                <p>Ve geldik videonun sonuna! Siyah beyaz dÃ¼nya biraz sÄ±kÄ±cÄ± olabilir. Patt Vira finalde renk katÄ±yor.</p>
                
                <div class="patt-box">
                    <strong>ğŸ¥ Renk Teorisi: HSB Modu</strong>
                    RGB (KÄ±rmÄ±zÄ±, YeÅŸil, Mavi) yerine <strong>HSB (Hue, Saturation, Brightness)</strong> kullanacaÄŸÄ±z.
                    <ul>
                        <li><strong>Hue (Ton):</strong> Rengin kendisi (0-360). Bunu sÃ¼rekli artÄ±rÄ±rsak gÃ¶kkuÅŸaÄŸÄ± dÃ¶ngÃ¼sÃ¼ elde ederiz.</li>
                    </ul>
                </div>

                <p>Tebrikler! Conway'in Hayat Oyunu'nu sÄ±fÄ±rdan inÅŸa ettiniz. Kodu kurcalamaktan Ã§ekinmeyin.</p>
                
            `,
            code: `/* 
   ----- Coding Tutorial by Patt Vira ----- 
   Name: Conway's Game of Life
   Video: https://youtu.be/lsWulRIWzdo
*/

let cols; let rows; let size = 5;
let grid; let play = true;
let hueValue = 0; 
let btnPlay, btnReset, btnRandom;

function setup() {
  createCanvas(400, 400);
  colorMode(HSB, 255); // Renk Modunu DeÄŸiÅŸtir
  grid = new Grid();
  
  btnPlay = createButton('Oynat/Durdur');
  btnPlay.mousePressed(playGrid);
  
  btnReset = createButton('Temizle');
  btnReset.mousePressed(resetGrid);
  
  btnRandom = createButton('Rastgele');
  btnRandom.mousePressed(randomGrid);
}

function draw() {
  background(220);
  if (play == true) {
    grid.update();
  }
  grid.display();
}

// --- ETKÄ°LEÅÄ°M FONKSÄ°YONLARI ---
function playGrid() { play = !play; }
function resetGrid() { grid.resetGrid(); }
function randomGrid() { grid.randomGrid(); }

function mouseDragged() {
  let margin = 2;
  let x = floor(mouseX / size);
  let y = floor(mouseY / size);
  
  for (let i=-margin; i<margin; i++) {
    for (let j=-margin; j<margin; j++) {
      // Kenar kontrolleri (Basit versiyon)
      let col = (x + i + grid.cols) % grid.cols;
      let row = (y + j + grid.rows) % grid.rows;
      if(grid.grid[col] && grid.grid[col][row] !== undefined) {
         grid.grid[col][row] = 1;
      }
    }
  }
  
  hueValue += 1;
  if (hueValue > 255) hueValue = 0;
}

class Grid {
  constructor() {
    this.cols = width/size;
    this.rows = height/size; 
    this.grid = [];
    this.randomGrid();
  }
  
  display() {
    for (let i=0; i<this.cols; i++) {
      for (let j=0; j<this.rows; j++) {
        if (this.grid[i][j] == 0) {
          if (play) fill(255);
          else fill(100);
        } else {
          fill(hueValue, 255, 255); // HSB Rengi
        }
        noStroke();
        rect(i*size, j*size, size, size);
      }
    }  
  }
  
  update() {
    let nextGen = [];
    for (let i=0; i<this.cols; i++) {
      nextGen[i] = [];
      for (let j=0; j<this.rows; j++) {
          let n = this.neighboringStates(this.grid, i, j);
          if (this.grid[i][j] == 1 && n < 2) {
            nextGen[i][j] = 0;
          } else if (this.grid[i][j] == 1 && (n == 2 || n ==3 )) {
            nextGen[i][j] = 1;
          } else if (this.grid[i][j] == 1 && n > 3) {
            nextGen[i][j] = 0;
          } else if (this.grid[i][j] == 0 && n == 3) {
            nextGen[i][j] = 1;
          } else {
            nextGen[i][j] = this.grid[i][j];
          }
        }
    }
    this.grid = nextGen;
    // Rengi gÃ¼ncelle
    hueValue = (hueValue + 0.5) % 255;
  }
  
  neighboringStates(grid, x, y) {
    let sum = 0;
    for (let i=-1; i<2; i++) {
      for (let j=-1; j<2; j++) {
        let xIndex = (x + i + this.cols) % this.cols;
        let yIndex = (y + j + this.rows) % this.rows;
        sum += grid[xIndex][yIndex];
      }
    }
    sum -= grid[x][y];
    return sum;
  }
  
  resetGrid() {
    for (let i=0; i<this.cols; i++) {
      for (let j=0; j<this.rows; j++) {
        this.grid[i][j] = 0;
      }
    }
  }
  
  randomGrid() {
    for (let i=0; i<this.cols; i++) {
      this.grid[i] = [];
      for (let j=0; j<this.rows; j++) {
        this.grid[i][j] = floor(random(2));
      }
    }
  }
}`
        }
    ];

    // --- UYGULAMA MANTIÄI ---

    let currentStep = 0;
    let myP5Instance = null;
    let codeMirrorEditor;

    window.onload = function() {
        codeMirrorEditor = CodeMirror.fromTextArea(document.getElementById("code-area"), {
            mode: "javascript",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
            tabSize: 2,
            lineWrapping: true,
            viewportMargin: Infinity
        });

        loadStep(0);
    };

    function loadStep(index) {
        currentStep = index;

        // UI GÃ¼ncelle
        document.getElementById('current-step').innerText = index + 1;
        document.getElementById('tutorial-content').innerHTML = steps[index].content + generateNavButtons();

        // EditÃ¶r Ä°Ã§eriÄŸini GÃ¼ncelle
        codeMirrorEditor.setValue(steps[index].code);

        // Kodu Ã‡alÄ±ÅŸtÄ±r
        runCode();
    }

    function generateNavButtons() {
        let html = '<div class="nav-area">';
        if (currentStep > 0) {
            html += `<button class="nav-btn" onclick="loadStep(${currentStep - 1})">â¬… Ã–nceki AdÄ±m</button>`;
        } else {
            html += `<div style="flex:1"></div>`; // BoÅŸluk tutucu
        }

        if (currentStep < steps.length - 1) {
            html += `<button class="nav-btn next" onclick="loadStep(${currentStep + 1})">Sonraki AdÄ±m â¡</button>`;
        }
        html += '</div>';
        return html;
    }

    function runCode() {
        const container = document.getElementById('p5-container');
        const controlsDiv = document.getElementById('p5-controls');
        const errorLog = document.getElementById('error-log');

        container.innerHTML = '';
        controlsDiv.innerHTML = ''; // ButonlarÄ± temizle
        errorLog.style.display = 'none';

        if (myP5Instance) {
            myP5Instance.remove();
            myP5Instance = null;
        }

        const userCode = codeMirrorEditor.getValue();

        const s = function(p) {
            p.setup = function() {};
            p.draw = function() {};
            
            // createButton'Ä± override edip bizim kontrol paneline yÃ¶nlendirelim
            // Bu sayede butonlar kaymaz!
            const originalCreateButton = p.createButton;
            p.createButton = function(label) {
                let btn = originalCreateButton.call(p, label);
                btn.parent('p5-controls'); // Bizim Ã¶zel kontrol div'imiz
                return btn;
            };

            try {
                // GÃ¼venli Ã§alÄ±ÅŸtÄ±rma
                const runnable = new Function('p', `
                    with(p) {
                        ${userCode}
                        
                        // P5 hooklarÄ±
                        if(typeof setup === 'function') p.setup = setup;
                        if(typeof draw === 'function') p.draw = draw;
                        if(typeof mousePressed === 'function') p.mousePressed = mousePressed;
                        if(typeof mouseDragged === 'function') p.mouseDragged = mouseDragged;
                        if(typeof mouseClicked === 'function') p.mouseClicked = mouseClicked;
                    }
                `);
                runnable(p);
            } catch (err) {
                console.error(err);
                errorLog.style.display = 'block';
                errorLog.innerText = "HATA: " + err.message;
            }
        };

        try {
            myP5Instance = new p5(s, 'p5-container');
        } catch (e) {
            errorLog.style.display = 'block';
            errorLog.innerText = "BaÅŸlatma HatasÄ±: " + e.message;
        }
    }
</script>

</body>
</html>

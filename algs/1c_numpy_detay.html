<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1.3: Numpy DetaylÄ± Ä°nceleme</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <style>
        /* Cache Visual */
        .cache-demo { display: flex; flex-direction: column; gap: 20px; margin: 20px 0; }
        .mem-block { display: flex; gap: 5px; padding: 10px; background: #eee; border-radius: 5px; overflow-x: auto; }
        .mem-cell { 
            min-width: 40px; height: 40px; border: 1px solid #ccc; background: white; 
            display: flex; align-items: center; justify-content: center; font-size: 12px;
        }
        .highlight { background: #2ecc71 !important; color: white; font-weight: bold; transform: scale(1.1); }
        .cache-line { border: 2px dashed #e67e22; position: relative; }
        .cache-line::after { content: "Cache Line"; position: absolute; top: -15px; left: 0; font-size: 10px; color: #e67e22; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ”¢ 1.3: Numpy DetaylÄ± Ä°nceleme</h1>
        <p>Python'da C Dizilerinin GÃ¼cÃ¼</p>
    </header>

    <div class="section">
        <h2>Numpy Array vs Python List</h2>
        <table>
            <thead>
                <tr>
                    <th>Ã–zellik</th>
                    <th>Python List ğŸ</th>
                    <th>Numpy Array ğŸ”¢</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Bellek</strong></td>
                    <td>DaÄŸÄ±nÄ±k (Referans)</td>
                    <td>BitiÅŸik (Blok)</td>
                </tr>
                <tr>
                    <td><strong>HÄ±z</strong></td>
                    <td>YavaÅŸ (Cache Miss)</td>
                    <td>Ã‡ok HÄ±zlÄ± (Cache Hit)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>ğŸï¸ CPU Cache ve Data Locality (Veri YerelliÄŸi)</h2>
        <p>Ä°ÅŸlemciler (CPU) veriyi RAM'den tek tek almaz, bloklar halinde (Cache Line) alÄ±r. Numpy bu mekanizmayÄ± mÃ¼kemmel kullanÄ±r.</p>
        
        <div class="cache-demo">
            <div>
                <h4>âœ… Numpy / C Dizisi (BitiÅŸik)</h4>
                <p style="font-size:0.9em">CPU ilk elemanÄ± okurken, yanÄ±ndaki elemanlar da otomatik olarak Cache'e gelir. Sonraki okumalar Ä±ÅŸÄ±k hÄ±zÄ±ndadÄ±r.</p>
                <div class="mem-block">
                    <div class="mem-cell highlight">10</div>
                    <div class="mem-cell highlight">20</div>
                    <div class="mem-cell highlight">30</div>
                    <div class="mem-cell highlight">40</div>
                    <div class="mem-cell">...</div>
                </div>
            </div>
            
            <div>
                <h4>âŒ Python Listesi (DaÄŸÄ±nÄ±k / Pointer Chasing)</h4>
                <p style="font-size:0.9em">Liste sadece adresleri tutar. GerÃ§ek veriler RAM'in rastgele yerlerindedir. CPU sÃ¼rekli RAM'e gitmek zorunda kalÄ±r (Cache Miss).</p>
                <div class="mem-block" style="justify-content: space-between;">
                    <div class="mem-cell highlight">10</div>
                    <div class="mem-cell">...</div>
                    <div class="mem-cell">...</div>
                    <div class="mem-cell highlight">20</div>
                    <div class="mem-cell">...</div>
                    <div class="mem-cell highlight">30</div>
                </div>
            </div>
        </div>
        
        <div style="background:#fff3cd; padding:15px; border-radius:5px; border-left:5px solid #f1c40f;">
            <strong>Teknik Detay:</strong> Python listesinde bir elemana eriÅŸmek iÃ§in iki iÅŸlem gerekir:
            1. Listeden adresi oku. 2. Adrese git ve deÄŸeri al (Dereferencing).
            Bu "zÄ±plama" iÅŸlemi CPU'nun tahmin mekanizmasÄ±nÄ± (Branch Prediction/Prefetching) bozar.
        </div>
    </div>

    <div class="section">
        <h2>ğŸ§ª Kod LaboratuvarÄ±: VektÃ¶rel HÄ±z</h2>
        <div class="code-container">
            <div class="code-header">
                <span>Python Kodu</span>
                <div>
                    <button class="btn btn-run" onclick="runPython('code')">â–¶ Ã‡alÄ±ÅŸtÄ±r</button>
                    <button class="btn" onclick="toggleEdit('code')">âœï¸ DÃ¼zenle</button>
                </div>
            </div>
            
            <pre id="view-code"><code class="language-python">import numpy as np
import time

# 1 Milyon eleman
boyut = 1_000_000
arr = np.random.rand(boyut)
liste = list(arr)

# Python DÃ¶ngÃ¼sÃ¼
start = time.time()
toplam_py = sum(liste)
print(f"Python: {time.time() - start:.6f} sn")

# Numpy VektÃ¶rel
start = time.time()
toplam_np = np.sum(arr)
print(f"Numpy : {time.time() - start:.6f} sn")</code></pre>

            <textarea id="code" class="code-editor">import numpy as np
import time

boyut = 1_000_000
arr = np.random.rand(boyut)
liste = list(arr)

start = time.time()
toplam_py = sum(liste)
print(f"Python: {time.time() - start:.6f} sn")

start = time.time()
toplam_np = np.sum(arr)
print(f"Numpy : {time.time() - start:.6f} sn")</textarea>
            
            <div id="output-code" class="output">Ã‡Ä±ktÄ± bekleniyor...</div>
        </div>
    </div>

    <div class="nav-footer">
        <a href="1b_c_dizileri.html" class="btn">â¬…ï¸ Ã–nceki: C Dizileri</a>
        <a href="2a_stack_giris.html" class="btn btn-next">Sonraki: Stack â¡ï¸</a>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script>
    let pyodideReady = false;
    let pyodide = null;

    async function main() {
        pyodide = await loadPyodide();
        await pyodide.loadPackage("numpy");
        pyodideReady = true;
    }
    main();

    async function runPython(id) {
        if(!pyodideReady) { alert("Python yÃ¼kleniyor..."); return; }
        const code = document.getElementById(id).value;
        const out = document.getElementById('output-' + id);
        out.innerText = "Ã‡alÄ±ÅŸÄ±yor...";
        try {
            pyodide.runPython(`import sys; from io import StringIO; sys.stdout = StringIO()`);
            await pyodide.runPythonAsync(code);
            out.innerText = pyodide.runPython("sys.stdout.getvalue()");
        } catch(e) {
            out.innerText = e;
        }
    }

    function toggleEdit(id) {
        const view = document.getElementById('view-' + id);
        const editor = document.getElementById(id);
        if (editor.style.display === 'block') {
            editor.style.display = 'none';
            view.style.display = 'block';
        } else {
            editor.style.display = 'block';
            view.style.display = 'none';
            editor.focus();
        }
    }
</script>
</body>
</html>
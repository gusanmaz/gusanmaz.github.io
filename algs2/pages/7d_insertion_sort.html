<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7.4: Insertion Sort (Eklemeli SÄ±ralama)</title>

    <!-- Unified CSS -->
    <link rel="stylesheet" href="../src/main.css">

    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
    <style>

        .visual-container {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .cards-visual {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            min-height: 120px;
            align-items: center;
        }
        .card {
            width: 50px;
            height: 70px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .card.sorted {
            background: linear-gradient(135deg, #27ae60, #1e8449);
        }
        .card.current {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            transform: translateY(-20px) scale(1.1);
        }
        .card.comparing {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        .card.shifting {
            animation: shift 0.3s ease-out;
        }
        @keyframes shift {
            0% { transform: translateX(0); }
            50% { transform: translateX(60px); }
            100% { transform: translateX(0); }
        }
        .divider {
            width: 3px;
            height: 80px;
            background: #e74c3c;
            border-radius: 2px;
        }
        .step-info {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 15px 0;
            min-height: 60px;
        }
        .analogy-box {
            background: linear-gradient(135deg, #fff5f5, #ffe5e5);
            border: 2px solid #e74c3c;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }
        </style>
</head>

<body>


<div class="container">
        <!-- Theme Toggle -->
        <button class="theme-toggle" aria-label="Toggle theme">ğŸŒ™</button>

    <header>
        <h1>ğŸ“¥ 7.4: Insertion Sort (Eklemeli SÄ±ralama)</h1>
        <p>Kart Oyununda El DÃ¼zenleme MantÄ±ÄŸÄ±</p>
    </header>

    <div class="section">
        <h2>ğŸ“Œ Insertion Sort Nedir?</h2>
        <p><strong>Insertion Sort</strong>, her elemanÄ± sÄ±ralÄ± bÃ¶lÃ¼mde doÄŸru yerine "sokan" bir algoritmadÄ±r. Kart oyunlarÄ±nda elimizdeki kartlarÄ± dÃ¼zenleme mantÄ±ÄŸÄ±na benzer.</p>

        <div class="analogy-box">
            <h4 style="margin-top: 0; color: #c0392b;">ğŸƒ Kart Oyunu Analojisi</h4>
            <p>Ä°skambil oynarken:</p>
            <ol style="margin-bottom: 0;">
                <li>Yeni bir kart Ã§ekersiniz</li>
                <li>Elinizdeki sÄ±ralÄ± kartlara bakarsÄ±nÄ±z</li>
                <li>Yeni kartÄ± doÄŸru yerine sokarsÄ±nÄ±z</li>
                <li>Bu ÅŸekilde eliniz her zaman sÄ±ralÄ± kalÄ±r!</li>
            </ol>
        </div>
    </div>

    <div class="visual-container">
        <h3 style="text-align: center;">ğŸ® Ä°nteraktif Insertion Sort SimÃ¼lasyonu</h3>
        <p style="text-align: center; color: #666;">ğŸŸ¢ SÄ±ralÄ± KÄ±sÄ±m | ğŸ”´ YerleÅŸtirilecek Kart | â¬œ SÄ±ralanmamÄ±ÅŸ KÄ±sÄ±m</p>

        <div class="cards-visual" id="cardsVisual"></div>

        <div class="step-info" id="stepInfo">
            ğŸ¯ "BaÅŸlat" butonuna tÄ±klayarak sÄ±ralamayÄ± izleyin.
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-run" onclick="startSort()">â–¶ï¸ BaÅŸlat</button>
            <button class="btn" onclick="stepSort()">â­ï¸ AdÄ±m</button>
            <button class="btn btn-reset" onclick="resetSort()">ğŸ”„ SÄ±fÄ±rla</button>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“Š KarmaÅŸÄ±klÄ±k Analizi</h2>

        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <thead>
                <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                    <th style="padding: 15px;">Durum</th>
                    <th style="padding: 15px;">Zaman</th>
                    <th style="padding: 15px;">AÃ§Ä±klama</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>En Ä°yi</strong></td>
                    <td style="padding: 12px; border: 1px solid #ddd; color: #27ae60; font-weight: bold;">O(n)</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">Dizi zaten sÄ±ralÄ± - sadece n-1 karÅŸÄ±laÅŸtÄ±rma</td>
                </tr>
                <tr style="background: #f8f9fa;">
                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Ortalama</strong></td>
                    <td style="padding: 12px; border: 1px solid #ddd; color: #e74c3c; font-weight: bold;">O(nÂ²)</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">Rastgele sÄ±ralÄ± dizi</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>En KÃ¶tÃ¼</strong></td>
                    <td style="padding: 12px; border: 1px solid #ddd; color: #e74c3c; font-weight: bold;">O(nÂ²)</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">Ters sÄ±ralÄ± dizi - her eleman en baÅŸa gider</td>
                </tr>
            </tbody>
        </table>

        <div style="background: #d4edda; padding: 15px; border-radius: 8px; border-left: 4px solid #27ae60;">
            <strong>ğŸ’¡ Insertion Sort'un GÃ¼Ã§lÃ¼ YÃ¶nÃ¼:</strong>
            <p style="margin: 5px 0 0 0;"><strong>Neredeyse sÄ±ralÄ± verilerde</strong> Ã§ok hÄ±zlÄ±dÄ±r! Verinin bÃ¼yÃ¼k kÄ±smÄ± sÄ±ralÄ±ysa O(n)'e yakÄ±n Ã§alÄ±ÅŸÄ±r. Bu nedenle kÃ¼Ã§Ã¼k dizilerde veya hibrit algoritmalarda (Timsort) kullanÄ±lÄ±r.</p>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ’» Python Implementasyonu</h2>

        <div class="code-container">
            <div class="code-header">
                <span>Python Kodu</span>
                <div>
                    <button class="btn btn-run" onclick="CodeBlocks.run(\'code1\')">â–¶ Ã‡alÄ±ÅŸtÄ±r</button>
                </div>
            </div>
            <pre id="view-code1"><code class="language-python line-numbers">def insertion_sort(arr):
    """
    Insertion Sort AlgoritmasÄ±

    Her elemanÄ± sÄ±ralÄ± bÃ¶lÃ¼mde doÄŸru yerine "sokar".
    """
    n = len(arr)
    comparisons = 0
    shifts = 0

    for i in range(1, n):
        key = arr[i]  # YerleÅŸtirilecek eleman
        j = i - 1

        print(f"\n--- AdÄ±m {i} ---")
        print(f"YerleÅŸtirilecek: {key}")
        print(f"SÄ±ralÄ± bÃ¶lÃ¼m: {arr[:i]}")

        # key'den bÃ¼yÃ¼k elemanlarÄ± saÄŸa kaydÄ±r
        while j >= 0 and arr[j] > key:
            comparisons += 1
            print(f"  {arr[j]} > {key} â†’ SaÄŸa kaydÄ±r")
            arr[j + 1] = arr[j]
            shifts += 1
            j -= 1

        if j >= 0:
            comparisons += 1
            print(f"  {arr[j]} â‰¤ {key} â†’ Dur")

        arr[j + 1] = key
        print(f"SonuÃ§: {arr}")

    return comparisons, shifts

# Test
dizi = [64, 34, 25, 12, 22, 11]
print(f"BaÅŸlangÄ±Ã§: {dizi}\n")

comp, shift = insertion_sort(dizi)

print(f"\n{'='*40}")
print(f"SonuÃ§: {dizi}")
print(f"KarÅŸÄ±laÅŸtÄ±rma: {comp}")
print(f"KaydÄ±rma: {shift}")</code></pre>
            <div id="output-code1" class="output">Ã‡Ä±ktÄ± bekleniyor...</div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸŒŸ AvantajlarÄ±</h2>
        <ul>
            <li>âœ… <strong>Adaptive:</strong> Neredeyse sÄ±ralÄ± dizilerde O(n)</li>
            <li>âœ… <strong>Stabil:</strong> EÅŸit elemanlarÄ±n sÄ±rasÄ± korunur</li>
            <li>âœ… <strong>In-place:</strong> O(1) ek alan</li>
            <li>âœ… <strong>Online:</strong> Veri gelirken anÄ±nda sÄ±ralayabilir</li>
            <li>âœ… <strong>KÃ¼Ã§Ã¼k veriler:</strong> n < 50 iÃ§in diÄŸer algoritmalardan hÄ±zlÄ±</li>
        </ul>

        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3; margin-top: 15px;">
            <strong>ğŸ’¡ Pratikte KullanÄ±m:</strong>
            <p style="margin: 5px 0 0 0;">Python'un <code>sort()</code> fonksiyonu (Timsort), kÃ¼Ã§Ã¼k parÃ§alarÄ± Insertion Sort ile sÄ±ralar. Ã‡Ã¼nkÃ¼ kÃ¼Ã§Ã¼k dizilerde overhead'sÄ±z ve cache-friendly!</p>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ†š O(nÂ²) AlgoritmalarÄ± KarÅŸÄ±laÅŸtÄ±rma</h2>

        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #667eea; color: white;">
                    <th style="padding: 12px;">Ã–zellik</th>
                    <th style="padding: 12px;">Bubble</th>
                    <th style="padding: 12px;">Selection</th>
                    <th style="padding: 12px;">Insertion</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">En Ä°yi Durum</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #27ae60;">O(n)</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #e74c3c;">O(nÂ²)</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #27ae60;">O(n)</td>
                </tr>
                <tr style="background: #f8f9fa;">
                    <td style="padding: 10px; border: 1px solid #ddd;">Takas SayÄ±sÄ±</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">O(nÂ²)</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #27ae60;">O(n)</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">O(nÂ²)</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Stabil</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">âœ…</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">âŒ</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">âœ…</td>
                </tr>
                <tr style="background: #f8f9fa;">
                    <td style="padding: 10px; border: 1px solid #ddd;">Online</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">âŒ</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">âŒ</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #27ae60;">âœ…</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>Ã–nerilen KullanÄ±m</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Sadece Ã¶ÄŸretim</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">Takas maliyetli</td>
                    <td style="padding: 10px; border: 1px solid #ddd; color: #27ae60;"><strong>KÃ¼Ã§Ã¼k/neredeyse sÄ±ralÄ±</strong></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="nav-footer">
        <a href="7c_selection_sort.html" class="btn">â¬…ï¸ Ã–nceki: Selection Sort</a>
        <a href="../index.html" class="btn" style="background:#e67e22">ğŸ  Ana MenÃ¼</a>
        <a href="7e_merge_sort.html" class="btn btn-next">Sonraki: Merge Sort â¡ï¸</a>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script>
    let array = [64, 34, 25, 12, 22, 11];
    const originalArray = [...array];
    let i = 1, j = 0;
    let key = null;
    let phase = 'pick'; // pick, compare, insert
    let isRunning = false;
    let sortInterval = null;

    function renderCards() {
        const container = document.getElementById('cardsVisual');
        container.innerHTML = '';

        array.forEach((val, idx) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.id = `card-${idx}`;
            card.innerText = val;

            if (idx < i) {
                card.classList.add('sorted');
            }
            if (idx === i && phase !== 'insert') {
                card.classList.add('current');
            }
            if (idx === j && phase === 'compare') {
                card.classList.add('comparing');
            }

            // SÄ±ralÄ± ve sÄ±ralanmamÄ±ÅŸ bÃ¶lÃ¼m arasÄ±na Ã§izgi
            if (idx === i - 1 && i < array.length) {
                container.appendChild(card);
                const divider = document.createElement('div');
                divider.className = 'divider';
                container.appendChild(divider);
            } else {
                container.appendChild(card);
            }
        });
    }

    function stepSort() {
        const n = array.length;

        if (i >= n) {
            document.querySelectorAll('.card').forEach(c => {
                c.classList.remove('current', 'comparing');
                c.classList.add('sorted');
            });
            document.getElementById('stepInfo').innerHTML = 'âœ… SÄ±ralama tamamlandÄ±!';
            pauseSort();
            return;
        }

        if (phase === 'pick') {
            key = array[i];
            j = i - 1;
            document.getElementById('stepInfo').innerHTML =
                `ğŸ´ Kart ${key} alÄ±ndÄ±, doÄŸru yeri aranÄ±yor...`;
            phase = 'compare';
        } else if (phase === 'compare') {
            if (j >= 0 && array[j] > key) {
                document.getElementById('stepInfo').innerHTML =
                    `ğŸ“ ${array[j]} > ${key} â†’ SaÄŸa kaydÄ±r`;
                array[j + 1] = array[j];
                j--;
            } else {
                phase = 'insert';
            }
        } else if (phase === 'insert') {
            array[j + 1] = key;
            document.getElementById('stepInfo').innerHTML =
                `âœ… ${key} yerine konuldu!`;
            i++;
            phase = 'pick';
        }

        renderCards();
    }

    function startSort() {
        if (i >= array.length) resetSort();
        isRunning = true;
        sortInterval = setInterval(() => {
            if (i < array.length) {
                stepSort();
            } else {
                stepSort();
                pauseSort();
            }
        }, 600);
    }

    function pauseSort() {
        isRunning = false;
        if (sortInterval) clearInterval(sortInterval);
    }

    function resetSort() {
        pauseSort();
        array = [...originalArray];
        i = 1; j = 0; key = null;
        phase = 'pick';
        renderCards();
        document.getElementById('stepInfo').innerHTML = 'ğŸ¯ "BaÅŸlat" butonuna tÄ±klayarak sÄ±ralamayÄ± izleyin.';
    }

    renderCards();

    // Pyodide
    let pyodideReady = false;
    let pyodide = null;
    async function main() { pyodide = await loadPyodide(); pyodideReady = true; }
    main();

    async function runPython(id) {
        if(!pyodideReady) { alert("Python yÃ¼kleniyor..."); return; }
        const code = document.getElementById('view-' + id).textContent;
        const out = document.getElementById('output-' + id);
        out.innerText = "Ã‡alÄ±ÅŸÄ±yor...";
        try {
            pyodide.runPython(`import sys; from io import StringIO; sys.stdout = StringIO()`);
            await pyodide.runPythonAsync(code);
            out.innerText = pyodide.runPython("sys.stdout.getvalue()");
        } catch(e) { out.innerText = e; }
    }
</script>

    <!-- Prism.js scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

    <!-- Pyodide CDN -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <!-- Unified JS -->
    <script src="../src/main.js"></script>
    <script src="../src/visualizations.js"></script>

    <!-- Page-specific JS -->
    <script>

    let array = [64, 34, 25, 12, 22, 11];
    const originalArray = [...array];
    let i = 1, j = 0;
    let key = null;
    let phase = 'pick'; // pick, compare, insert
    let isRunning = false;
    let sortInterval = null;

    function renderCards() {
        const container = document.getElementById('cardsVisual');
        container.innerHTML = '';

        array.forEach((val, idx) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.id = `card-${idx}`;
            card.innerText = val;

            if (idx < i) {
                card.classList.add('sorted');
            }
            if (idx === i && phase !== 'insert') {
                card.classList.add('current');
            }
            if (idx === j && phase === 'compare') {
                card.classList.add('comparing');
            }

            // SÄ±ralÄ± ve sÄ±ralanmamÄ±ÅŸ bÃ¶lÃ¼m arasÄ±na Ã§izgi
            if (idx === i - 1 && i < array.length) {
                container.appendChild(card);
                const divider = document.createElement('div');
                divider.className = 'divider';
                container.appendChild(divider);
            } else {
                container.appendChild(card);
            }
        });
    }

    function stepSort() {
        const n = array.length;

        if (i >= n) {
            document.querySelectorAll('.card').forEach(c => {
                c.classList.remove('current', 'comparing');
                c.classList.add('sorted');
            });
            document.getElementById('stepInfo').innerHTML = 'âœ… SÄ±ralama tamamlandÄ±!';
            pauseSort();
            return;
        }

        if (phase === 'pick') {
            key = array[i];
            j = i - 1;
            document.getElementById('stepInfo').innerHTML =
                `ğŸ´ Kart ${key} alÄ±ndÄ±, doÄŸru yeri aranÄ±yor...`;
            phase = 'compare';
        } else if (phase === 'compare') {
            if (j >= 0 && array[j] > key) {
                document.getElementById('stepInfo').innerHTML =
                    `ğŸ“ ${array[j]} > ${key} â†’ SaÄŸa kaydÄ±r`;
                array[j + 1] = array[j];
                j--;
            } else {
                phase = 'insert';
            }
        } else if (phase === 'insert') {
            array[j + 1] = key;
            document.getElementById('stepInfo').innerHTML =
                `âœ… ${key} yerine konuldu!`;
            i++;
            phase = 'pick';
        }

        renderCards();
    }

    function startSort() {
        if (i >= array.length) resetSort();
        isRunning = true;
        sortInterval = setInterval(() => {
            if (i < array.length) {
                stepSort();
            } else {
                stepSort();
                pauseSort();
            }
        }, 600);
    }

    function pauseSort() {
        isRunning = false;
        if (sortInterval) clearInterval(sortInterval);
    }

    function resetSort() {
        pauseSort();
        array = [...originalArray];
        i = 1; j = 0; key = null;
        phase = 'pick';
        renderCards();
        document.getElementById('stepInfo').innerHTML = 'ğŸ¯ "BaÅŸlat" butonuna tÄ±klayarak sÄ±ralamayÄ± izleyin.';
    }

    renderCards();

    // Pyodide
    let pyodideReady = false;
    let pyodide = null;
    async function main() { pyodide = await loadPyodide(); pyodideReady = true; }
    main();

    async function runPython(id) {
        if(!pyodideReady) { alert("Python yÃ¼kleniyor..."); return; }
        const code = document.getElementById('view-' + id).textContent;
        const out = document.getElementById('output-' + id);
        out.innerText = "Ã‡alÄ±ÅŸÄ±yor...";
        try {
            pyodide.runPython(`import sys; from io import StringIO; sys.stdout = StringIO()`);
            await pyodide.runPythonAsync(code);
            out.innerText = pyodide.runPython("sys.stdout.getvalue()");
        } catch(e) { out.innerText = e; }
    }

    </script>
</body>
</html>
